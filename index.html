<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factura</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            padding: 2mm 4mm;
            margin: 0;
            width: 72mm;
        }

        h1 {
            font-size: 1.2em;
            text-align: center;
            margin: 2mm 0;
            border-bottom: 1px solid #000;
            padding-bottom: 1mm;
        }

        h2 {
            font-size: 0.9em;
            margin: 2mm 0;
        }

        p, .centered {
            margin: 1mm 0;
            font-size: 0.8em;
        }

        .centered {
            text-align: center;
            margin-bottom: 2mm;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 2mm 0;
        }

        table th, table td {
            padding: 0.5mm;
            text-align: left;
            border: none;
        }

        .total {
            font-size: 1em;
            font-weight: bold;
            margin-top: 2mm;
        }

        .footer {
            border-top: 1px solid #000;
            margin-top: 2mm;
            padding-top: 1mm;
        }

        .qr-section {
            text-align: center;
            margin-top: 5mm;
        }

    </style>
    <script>
        function getParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                companyName: params.get('companyName'),
                rnc: params.get('rnc'),
                telefono: params.get('telefono'),
                whatsapp: params.get('whatsapp'),
                direccion: params.get('direccion'),
                cliente: params.get('cliente'),
                facturaId: params.get('facturaId'),
                fecha: params.get('fecha'),
                vendedor: params.get('vendedor'),
                productos: params.get('productos')?.split(',') || [],
                cantidades: params.get('cantidades')?.split(',') || [],
                precios: params.get('precios')?.split(',') || [],
                subtotales: params.get('subtotales')?.split(',') || [],
                subtotal: parseFloat(params.get('subtotal')) || 0,
                descuento: parseFloat(params.get('descuento')) || 0,
                total: parseFloat(params.get('total')) || 0,
                qrCodeUrl: params.get('qrCodeUrl')
            };
        }

        function renderFactura() {
            const params = getParams();

            // Datos fijos de la empresa
            document.getElementById('companyName').textContent = params.companyName || '';
            document.getElementById('rnc').textContent = params.rnc || '';
            document.getElementById('telefono').textContent = params.telefono || '';
            document.getElementById('whatsapp').textContent = params.whatsapp || '';
            document.getElementById('direccion').textContent = params.direccion || '';

            // Datos de la venta
            document.getElementById('cliente').textContent = params.cliente || '';
            document.getElementById('facturaId').textContent = params.facturaId || '';
            document.getElementById('fecha').textContent = params.fecha || '';
            document.getElementById('vendedor').textContent = params.vendedor || '';

            // Productos
            const productosBody = document.getElementById('productos');
            params.productos.forEach((producto, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${producto}</td>
                    <td>${params.cantidades[index]}</td>
                    <td>$${parseFloat(params.precios[index]).toFixed(2)}</td>
                    <td>$${parseFloat(params.subtotales[index]).toFixed(2)}</td>
                `;
                productosBody.appendChild(row);
            });

            // Totales
            document.getElementById('subtotal').textContent = `$${params.subtotal.toFixed(2)}`;
            document.getElementById('descuento').textContent = `$${params.descuento.toFixed(2)}`;
            document.getElementById('total').textContent = `$${params.total.toFixed(2)}`;

            // Código QR
            const qrCodeImg = document.getElementById('qrCode');
            qrCodeImg.src = params.qrCodeUrl;

            // Auto Print
            window.print();
        }
    </script>
</head>
<body onload="renderFactura()">
    <h1 id="companyName"></h1>
    <p class="centered">RNC: <span id="rnc"></span></p>
    <p class="centered">Teléfono: <span id="telefono"></span></p>
    <p class="centered">WhatsApp: <span id="whatsapp"></span></p>
    <p class="centered" id="direccion"></p>

    <h2>Cliente: <span id="cliente"></span></h2>
    <p>Código Factura: <span id="facturaId"></span></p>
    <p>Fecha: <span id="fecha"></span></p>
    <p>Vendedor: <span id="vendedor"></span></p>

    <h2>Detalles de Venta</h2>
    <table>
        <thead>
            <tr>
                <th>Producto</th>
                <th>Cant.</th>
                <th>Precio</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody id="productos"></tbody>
    </table>

    <p>Subtotal: <span id="subtotal"></span></p>
    <p>Descuento: <span id="descuento"></span></p>
    <p class="total">Total: <span id="total"></span></p>

    <div class="qr-section">
        <p>Consultar garantía en línea:</p>
        <img id="qrCode" alt="QR Code">
    </div>
</body>
</html>
