<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factura</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            width: 80mm;
        }
        .factura {
            padding: 10px;
        }
        .titulo {
            text-align: center;
            font-size: 14px;
            font-weight: bold;
        }
        .datos {
            font-size: 10px;
            margin: 5px 0;
            text-align: left;
        }
        table {
            width: 100%;
            font-size: 10px;
            border-collapse: collapse;
        }
        th, td {
            padding: 2px;
            text-align: left;
        }
        th {
            border-bottom: 1px solid #000;
        }
        .totales {
            font-size: 10px;
            margin-top: 10px;
        }
        .totales p {
            margin: 2px 0;
        }
        .pie {
            margin-top: 10px;
            font-size: 9px;
            text-align: justify;
        }
        .qr {
            text-align: center;
            margin-top: 10px;
        }
        img {
            width: 80px;
            height: 80px;
        }
    </style>
    <script>
        function getParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                cliente: params.get('cliente'),
                facturaId: params.get('facturaId'),
                fecha: params.get('fecha'),
                vendedor: params.get('vendedor'),
                productos: params.get('productos')?.split(',') || [],
                cantidades: params.get('cantidades')?.split(',') || [],
                precios: params.get('precios')?.split(',') || [],
                subtotales: params.get('subtotales')?.split(',') || [],
                subtotal: parseFloat(params.get('subtotal')) || 0,
                descuento: parseFloat(params.get('descuento')) || 0,
                impuesto: parseFloat(params.get('impuesto')) || 0,
                total: parseFloat(params.get('total')) || 0
            };
        }

        function renderFactura() {
            const params = getParams();

            // Datos fijos de la empresa
            document.getElementById('cliente').textContent = params.cliente || 'Cliente de paso';
            document.getElementById('facturaId').textContent = params.facturaId || '';
            document.getElementById('fecha').textContent = params.fecha || '';
            document.getElementById('vendedor').textContent = params.vendedor || '';

            // Productos
            const productosBody = document.getElementById('productos');
            params.productos.forEach((producto, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${producto}</td>
                    <td>${params.cantidades[index]}</td>
                    <td>$${parseFloat(params.precios[index]).toFixed(2)}</td>
                    <td>$${parseFloat(params.subtotales[index]).toFixed(2)}</td>
                `;
                productosBody.appendChild(row);
            });

            // Totales
            document.getElementById('importe').textContent = `$${params.subtotal.toFixed(2)}`;
            document.getElementById('descuento').textContent = `$${params.descuento.toFixed(2)}`;
            const impuestoCalculado = (params.subtotal - params.descuento) * 0.18;
            document.getElementById('impuesto').textContent = `$${impuestoCalculado.toFixed(2)}`;
            document.getElementById('total').textContent = `$${(params.subtotal - params.descuento + impuestoCalculado).toFixed(2)}`;

            // Auto print
            window.print();
        }
    </script>
</head>
<body onload="renderFactura()">
    <div class="factura">
        <div class="titulo">GAVASLO ADVANCED TECHNOLOGY S.R.L.</div>
        <div class="datos">
            <p>RNC: 132-01902-4</p>
            <p>Teléfono: 809-375-7766</p>
            <p>WhatsApp: 809-375-7766</p>
            <p>PLAZA SANTANA VASQUEZ, EL SAMÁN, AL LADO DE PANADERÍA SANTANA, TAMBORIL.</p>
        </div>
        <div class="datos">
            <p><strong>Cliente:</strong> <span id="cliente"></span></p>
            <p><strong>Código Factura:</strong> <span id="facturaId"></span></p>
            <p><strong>Fecha:</strong> <span id="fecha"></span></p>
            <p><strong>Vendedor:</strong> <span id="vendedor"></span></p>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cant.</th>
                    <th>Precio</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody id="productos"></tbody>
        </table>
        <div class="totales">
            <p>Importe: <span id="importe"></span></p>
            <p>Descuento: <span id="descuento"></span></p>
            <p>Impuesto (ITBIS 18%): <span id="impuesto"></span></p>
            <p><strong>Total a Pagar: <span id="total"></span></strong></p>
        </div>
        <div class="pie">
            GRACIAS POR SU COMPRA EN GAVASLO. POR FAVOR, NOTE QUE LA GARANTÍA DE CADA EQUIPO SE ENCUENTRA DETALLADA JUNTO A LA DESCRIPCIÓN DEL PRODUCTO VENDIDO. NO NOS HACEMOS RESPONSABLES DE EQUIPOS DEJADOS EN REPARACIÓN POR MÁS DE 15 DÍAS. NO REALIZAMOS DEVOLUCIÓN DE DINERO. LA GARANTÍA SÓLO INCLUYE REPARACIONES Y PIEZAS EN CASO DE SER NECESARIO, NO INCLUYE REEMPLAZO DE EQUIPOS. CUENTA CORRIENTE BANRESERVAS: 9606863389.
        </div>
        <div class="qr">
            <p>Consultar garantía en línea:</p>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://datafacturas.github.io/facturas/" alt="QR Code">
        </div>
    </div>
</body>
</html>
